# Hive Mind 操作手册

本文档用于指导你在本地启动、配置、运行和维护 `codex app` 三人 Agent Team 系统。

## 1. 系统概览

### 1.1 角色分工

- Human：输入战略目标
- Echo（协调中枢）：拆解目标、分发任务、汇总结果
- Elon（CTO）：处理技术任务（架构 / 评审测试 / 调试修复）
- Henry（CMO）：处理增长任务（社区 / 内容 / 数据分析）

### 1.2 执行流程

1. Human 输入目标
2. Echo 将目标拆解为 `elon_tasks` 和 `henry_tasks`
3. Elon 与 Henry 并行执行各自子代理
4. Echo 汇总结果并返回给 Human

---

## 2. 环境准备

### 2.1 依赖要求

- Python 3.11+
- 可用的 Anthropic API Key

### 2.2 安装依赖

在项目根目录执行：

```bash
python -m pip install -r requirements-dev.txt
```

### 2.3 配置环境变量

系统支持两种方式读取配置：

- 方式 A（推荐）：系统环境变量（你当前就是这种）
- 方式 B：项目根目录 `.env`

至少需要：

```dotenv
ANTHROPIC_API_KEY=your_real_key
```

可选（走代理网关/中转服务时使用）：

```dotenv
ANTHROPIC_BASE_URL=https://your-proxy-endpoint
```

如果你需要本地 `.env` 文件：

```bash
copy .env.example .env
```

> 注意：`.env` 不要提交到版本库。

---

## 3. 启动与使用

### 3.1 启动应用

```bash
python main.py
```

启动后你会看到：

```text
Hive Mind 已启动。输入你的战略目标：
```

### 3.2 交互方式

- 输入任意战略目标（例如：`7 天内上线 codex app`）
- 输入 `exit` 或 `quit` 退出系统

### 3.3 示例会话

```text
Human > 7 天内上线 codex app，并完成首批 100 个种子用户
Echo > （Echo 汇总后的战略与行动建议）
```

---

## 4. 日志说明

系统会输出带角色前缀的日志，便于排查问题：

- `[Echo]`：目标拆解与汇总阶段
- `[Elon]` / `[Elon/Architecture]` / `[Elon/Review]` / `[Elon/Debug]`
- `[Henry]` / `[Henry/Community]` / `[Henry/Content]` / `[Henry/Analytics]`

如果未配置 API Key 或本机未安装 Anthropic SDK，会进入离线回退模式并打印提示。

---

## 5. Henry 行为护栏（硬约束）

Henry 明确禁止以下行为：

- mass mention（批量 @）
- spam（刷评论 / 重复发帖）
- 未经请求的私信

触发后将：

1. 立即停止执行
2. 返回 `status = "error"`
3. 报告给 Echo

---

## 6. 测试与校验

### 6.1 运行测试

```bash
python -m pytest -q
```

当前包含测试：

- Henry 护栏拦截测试
- Echo 拆解 JSON 回退测试

### 6.2 语法检查

```bash
python -m compileall base_agent.py echo.py elon.py henry.py main.py tests/test_agents.py
```

---

## 7. 常见问题（FAQ）

### Q1：为什么输出里出现 `[offline:Echo]`？

A：说明没有可用的在线模型调用条件：

- `ANTHROPIC_API_KEY` 未设置，或
- `anthropic` SDK 未安装

先执行依赖安装，并确认系统环境变量或 `.env` 配置。

### Q2：我已经在系统环境变量里配了 Key，还需要 `.env` 吗？

A：不需要。代码会优先读取系统环境变量，`.env` 只是本地补充方案。

### Q3：什么时候需要 `ANTHROPIC_BASE_URL`？

A：仅当你通过代理网关调用模型时需要；直连官方接口可留空。

### Q4：任务拆解结果不稳定怎么办？

A：建议：

1. 输入更清晰的战略目标（时间、目标、约束）
2. 在目标中明确优先级和业务场景
3. 通过修改 `echo.py` 中拆解提示词增强结构化约束

---

## 8. 二次开发建议

- 增加消息协议校验（如 Pydantic Schema）
- 增加任务历史与可观测性（文件或数据库）
- 为 Echo 增加“失败重试 + 降级策略”
- 为 Henry 护栏加入更严格的规则引擎或策略审计

如需我继续，我可以再给你补一份《部署手册》（Windows/Linux）和《Prompt 调优手册》。
